<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Explore Earth Online RPG</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/pixel.css">
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
</head>
<body>

<%- include('partials/navbar', { user: user, showSearchBar: true }) %>

<div class="container mt-3">
  <% if (posts.length === 0) { %>
    <div class="text-center mt-5">
      <p>SO QUIET HERE~ POST SOMETHING! <a href="/posts/new">Create your first post</a>!</p>
    </div>
  <% } %>

  <% posts.forEach(p => { %>
    <div class="card mb-2 position-relative" data-pid="<%= p._id.toLowerCase() %>">
      <a href="/posts/<%= p._id %>" class="stretched-link text-decoration-none text-dark"></a>
      <% if (p.image && p.image.length > 0) { %>
        <img src="/posts/image/<%= p._id %>/0" class="card-img-top"
             style="max-height:180px;object-fit:contain;background:#f5f5f5;" alt="cover">
      <% } %>
      <div class="card-body">
        <h5 class="card-title text-truncate"><%= p.title %></h5>
        <small class="text-muted">
          <% if (p.author) { %>
            Lv.<%= p.author.lv != null ? p.author.lv : 0 %> <%= p.author.username %> | <%= p.createdAt.toLocaleString() %>
          <% } else { %>
            Lv.0 deleted user | <%= p.createdAt.toLocaleString() %>
          <% } %>
        </small><br>
        <div class="mt-2" style="position:relative; z-index:2;">
          <a class="btn btn-sm btn-outline-secondary" href="/posts/edit/<%= p._id %>">Edit</a>
          <form action="/posts/<%= p._id %>?_method=DELETE" method="post" style="display:inline;">
            <button class="btn btn-sm btn-outline-danger" 
                    onclick="return confirm('Delete this post?')">Delete</button>
          </form>
        </div>
      </div>
    </div>
  <% }) %>
</div>


</body>
</html>
